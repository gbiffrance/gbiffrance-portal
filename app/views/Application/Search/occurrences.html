<div id="occurrences" class="alert" style="margin-top:20px;">
  <h3>Occurrences</h3>
  
  
  #{if nbHits}
    <div class="well">
      <h4> Taxons les plus fréquents dans la liste d'occurrences ci-dessous :</h4>
      <table class="table">
        #{list items:taxas, as:'taxa'}
          <tr>
            <td><a href="@{Taxas.show(taxa.taxonId)}"><i>${taxa.scientificName}</i></a></td>
            <!-- Result filter based on ecat -->
            <td><a onClick="searchOccurrences('${taxa.taxonId}', '${search.placeText}', '${search.dataset}', '${search.onlyWithCoordinates}','0');">${taxa.occurrencesCount} occurrences</a></td>        
          </tr>
       #{/list}
      </table>
    </div>
   
    <!-- Pagination -->
    #{if occurrencesTotalPages == 100}<i>5000 first results for a total of ${nbHits} occurrences</i><br/>#{/if}
    #{else}Page ${current} for ${nbHits} results<br/>#{/else}
    #{if occurrencesTotalPages > 1}
      #{if current >= 10 && current+10 < occurrencesTotalPages}        
        <a onClick="searchOccurrences('${search.taxaText}', '${search.placeText}', '${search.dataset}', '${search.onlyWithCoordinates}','${1*pagesize}');">1 </a>
        ...
        #{list items:current-5..current+5, as:'i'}
          <a onClick="searchOccurrences('${search.taxaText}', '${search.placeText}', '${search.dataset}', '${search.onlyWithCoordinates}','${i*pagesize}');">${i} </a>
        #{/list}
        ...
        <a onClick="searchOccurrences('${search.taxaText}', '${search.placeText}', '${search.dataset}', '${search.onlyWithCoordinates}','${occurrencesTotalPages*pagesize}');">${occurrencesTotalPages} </a>
      #{/if} 
      #{elseif current >= 10 && current+10 >= occurrencesTotalPages}        
        <a onClick="searchOccurrences('${search.taxaText}', '${search.placeText}', '${search.dataset}', '${search.onlyWithCoordinates}','${1*pagesize}');">1 </a>
        ...
        #{list items:current-10..occurrencesTotalPages, as:'i'}
          <a onClick="searchOccurrences('${search.taxaText}', '${search.placeText}', '${search.dataset}', '${search.onlyWithCoordinates}','${i*pagesize}');">${i} </a>
        #{/list}
      #{/elseif}
      #{elseif current == occurrencesTotalPages}
        <a onClick="searchOccurrences('${search.taxaText}', '${search.placeText}', '${search.dataset}', '${search.onlyWithCoordinates}','0');">${1} </a>
        ...
        #{list items:current-10..current, as:'i'}
          <a onClick="searchOccurrences('${search.taxaText}', '${search.placeText}', '${search.dataset}', '${search.onlyWithCoordinates}','${i*pagesize}');">${i} </a>
        #{/list}
      #{/elseif}  
      #{elseif current == 0 || current < 10}
        #{list items:1..10, as:'i'}
          <a onClick="searchOccurrences('${search.taxaText}', '${search.placeText}', '${search.dataset}', '${search.onlyWithCoordinates}','${i*pagesize}');">${i} </a>
        #{/list}
        ...
        <a onClick="searchOccurrences('${search.taxaText}', '${search.placeText}', '${search.dataset}', '${search.onlyWithCoordinates}','${occurrencesTotalPages*pagesize}');">${occurrencesTotalPages} </a>
      #{/elseif}  
      #{if current < occurrencesTotalPages}    
        <a style="float:right;" onClick="searchOccurrences('${search.taxaText}', '${search.placeText}', '${search.dataset}', '${search.onlyWithCoordinates}','${current*pagesize}');">Next >></a>
      #{/if}
    #{/if}
    
    <table class="table table-condensed table-striped table-bordered">
      <thead>
        <tr>
          <th>Scientific Name</th>
          <th>Catalog Number</th>
          <th>Dataset</th>
          <th>Data Publisher</th>
          <th>Coordinates</th>
        </tr>
      </thead>
      #{list items:occurrences, as:'occurrence'}
        #{if max && max < occurrence.score}
          ${max = occurrence.score}
        #{/if}  
        #{if occurrence.score > max}<tr class="alert alert-info">#{/if}
        #{else}<tr>#{/else}
        <td><a href="@{Occurrences.show(occurrence.id)}"><i>${occurrence.scientificName}</i></a></td>
        <td>${occurrence.catalogNumber}</td>        
        <td><a href="@{Datasets.show(occurrence.dataset.id)}">${occurrence.dataset.title}</a></td>
        <td><a href="@{DataPublishers.show(occurrence.dataset.dataPublisher.id)}">${occurrence.dataset.dataPublisher.name}</a></td>
        <td>#{if occurrence.decimalLatitude && occurrence.decimalLongitude}yes<!-- ${occurrence.decimalLatitude}<br/>${occurrence.decimalLongitude} -->#{/if}</td>
        <!-- <td>${occurrence.score}</td> -->  
      </tr>
      #{/list}
    </table>
    <script type="javascript">
// x='hola';
    </script>
    <!--#{if from && from < nbHits}
    <div style="float:right;">
      <b><a onClick="searchOccurrences('${search.taxaText}', '${search.placeText}', '${search.dataset}', '${search.onlyWithCoordinates}','${from}');">Suivant</a></b>
    </div>
    #{/if}-->
  #{/if}
  #{else}
    <h6>Pas de résultats</h6>  
  #{/else}
</div>
