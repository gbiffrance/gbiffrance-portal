#{extends 'main.html' /}
#{set title:'Home' /}
<link rel="stylesheet" media="screen" href="@{'/public/stylesheets/leaflet.css'}">
      
      <script src="@{'/public/javascripts/mapping/leaflet-src.js'}"></script>
      <script src="@{'/public/javascripts/d3.v2.min.js'}"></script>
  <script src="http://lully.snv.jussieu.fr/gbif/mapping/test_maps/wax/dist/wax.leaf.min.js">
  </script>
<script src="@{'/public/javascripts/jquery.tipsy.js'}"></script>
<link rel="stylesheet" media="screen" href="@{'/public/stylesheets/tipsy.css'}">
<script type="text/javascript">
 var _selected_circle;
$(document).ready(function() {

dataset='${occurrence.dataset.id}';

dataset_name='${occurrence.datasetName}';

lat=${occurrence.decimalLatitude};
lng=${occurrence.decimalLongitude};
taxa='${occurrence.scientificName}';

var kingdom='${occurrence.kingdom_interpreted}'
var phylum='${occurrence.phylum_interpreted}' 
var classs='${occurrence.classs_interpreted}'
var order='${occurrence.orderr_interpreted}'
var family='${occurrence.family_interpreted}' 
genus='${occurrence.genus_interpreted}' 
 
var specificEpithet='${specificEpithet_interpreted}'

if (lat && lng)
{

var geojson;

function remove_json()
{
for (var k in map._layers) {
    if (map._layers.hasOwnProperty(k)) {

       if (map._layers[k].my_geojson==true)
{
map.removeLayer(map._layers[k])
//console.warn(map._layers[k])
}

    }
}
}
    
//to improve symbology, not proportional
function apply_parsing(e)
{

 var count=e.properties.count; 

this_count=count;
//default styles for all paths are already defined in leaflet-src.js (L.Path = L.Class.extend({ options....)
if (this_count>=geojson_min && this_count<interval_1)
{
 e.layer.setStyle({fillColor:'#E0E043'});
}
if (this_count>=interval_1 && this_count<geojson_medium)
{
 e.layer.setStyle({fillColor:'#64E580'});
}
if 
(this_count>=geojson_medium && this_count<interval_2)
{
e.layer.setStyle({fillColor:'#6391ED'});
}
if (this_count>=interval_2 && this_count<=geojson_max)
{
e.layer.setStyle({fillColor:'#EA38D5'});
}
 

   // }  
    var popupContent='Here we found '+ count+' occurrences for taxa '+taxa;
    e.layer.bindPopup(popupContent);

}


function explode_cluster(options,explode_level)
{

$.ajax({
    url: 'http://lully.snv.jussieu.fr/gbif/mapping/php/geojson.php',
    method: 'get',
    dataType: 'jsonp',
    crossDomain: 'true',
    // options={'taxa':taxa,'explode_level':'all','type':to_plot,'collection':collection}  //explode_all options
    data: options,
    success: function(data) {

      if (explode_level=='by_cluster')
      {
        //console.warn('exploding cluster')
        var bounds=data.data_bbox;
        var bottom_left=bounds[0].split(',')
        var up_right=bounds[1].split(',')
        bounds = new L.LatLngBounds(
        new L.LatLng(bottom_left[1],bottom_left[0]),
        new L.LatLng(up_right[1],up_right[0]));
        zoom=map.getBoundsZoom(bounds)        
        map.setView(new L.LatLng(data.y_center,data.x_center), zoom);

      } 
      else
      {
        zoom=map.getBoundsZoom(map.getBounds())
      }
     
maxValue=data.total ;
   
switch (true)
{
    case (zoom <=3):
      grid=10; 
      min_range=5;
      max_range=15;
      break;
   case (zoom >=4 && zoom<6): 
    min_range=2; max_range=10;
   break;

   case (zoom>=6): 
   min_range=4;max_range=15;
   break;
}

 
    var rScale = d3.scale.linear()
                     .domain([0, d3.max(data.features, function(d) { return d.properties.count; })])
                     .range([min_range, max_range]);
     
  //  var ramp=d3.scale.linear().domain([min_range, maxValue]).range(["#E2F268","#F22B88"]);
  //  var ramp=d3.scale.linear().domain([min_range, maxValue])//.range(['red','grey']);
    var ramp=d3.scale.category20c().domain([min_range, maxValue]) 
    /* Add a LatLng object to each item in the dataset */
   
    data.features.forEach(function(d) {
      d.LatLng = new L.LatLng(d.geometry.coordinates[1],d.geometry.coordinates[0])
    
    })

    var circle = g.selectAll("circle .exploded_cluster")
      .data(data.features);

      circle.enter().append("circle").attr('class','exploded_cluster');
     // circle.exit().remove()

    function first_update2() {
      circle.attr("cx",function(d) { return map.latLngToLayerPoint(d.LatLng).x})
      circle.attr("cy",function(d) { return map.latLngToLayerPoint(d.LatLng).y}).attr("stroke", "black")
      circle.on("mouseover", function(d) {
        var _this=d3.select(this)
        _this.original_color=_this.attr('fill');
      _this.transition().duration(500).attr('opacity',1)

    })
  

      circle.attr("r", function(d) {      
        return rScale(d.properties.count);
      }).attr('fill',function (d){ 

        return ramp(d.properties.count)})
                        .attr('opacity',0.7)

    
    }

     function update() {
      circle.attr("cx",function(d) { return map.latLngToLayerPoint(d.LatLng).x})
      circle.attr("cy",function(d) { return map.latLngToLayerPoint(d.LatLng).y})


    }
    map.on("viewreset", update);
    first_update2();

         $('svg circle').tipsy({ 
                              delayIn: 500, 
                              fade: true, 
                              gravity: 'w', 
                              html: true, 
                              title: function() {
                                var d = this.__data__;
                                d.bounds=bounds;
                                zoom=map.getBoundsZoom(bounds)
                                d.zoom=zoom;
                                
                                var this_text='There are <b>'+d.properties.count+'</b> occurrences for taxa '+taxa+' in this cluster';
                                // this_text+='<p><a href="#" class="back_cluster" zoom="'+zoom+'" degree="'+cluster_degree+'" bbox="'+d.geometry.coordinates+'">Re-construct this cluster</a>'; 
                                                              
                                return this_text;
                                
                              }
                            });

    } //end ajax callback
     });

   }  //end function explode_cluster

$('.tipsy-inner a').live('click',function()
{
cluster_action=$(this).attr('class')

taxa=genus;

if (cluster_action=='by_cluster')
{
  var bbox=$(this).attr('bbox');  
  circle_xy=$(this).attr('bbox');
  options={'taxa':taxa,'explode_level':'by_cluster','bbox':circle_xy,'type':to_plot,'dataset':dataset,'cluster_degree':cluster_degree,'explode_type':cluster_action,'requested_action':'explode'}
  explode_cluster(options,'by_cluster');
  _selected_circle.attr('opacity',0);
}
})
 function create_circles (data,options)
 {
maxValue=data.total;
cluster_degree=data.cluster_degree;
var zoom=options.zoom;
switch (true)
{
   case (zoom <=3):
      grid=10; 
      min_range=5;
      max_range=15;
      break;
   case (zoom >=4 && zoom<6): 
    min_range=4; 
    max_range=15;
   break;
   case (zoom>=6): 
   min_range=10;
   max_range=30;
   break;
}

    var rScale = d3.scale.linear()
                     .domain([0, d3.max(data.features, function(d) { return d.properties.count; })])
                     .range([min_range, max_range]);

    var count_extent = d3.extent( data.features, function(d){return d.properties.count});
    //other symbolizing options
    //var ramp = d3.scale.linear() .domain(count_extent)// .range(["blue","red"]);
   //.range(["#FDFFCB", "#232942"])
   var ramp =d3.scale.category20c().domain(count_extent)
   //.interpolate(d3.cie.interpolateLch);

    /* Add a LatLng object to each item in the dataset */  
    data.features.forEach(function(d) {
      d.LatLng = new L.LatLng(d.geometry.coordinates[1],d.geometry.coordinates[0])
    })

    var circle = g.selectAll("circle")
      .data(data.features);
      circle.enter().append("circle");
      circle.exit().remove()

    function first_update(cluster_degree) 
    {
      circle.attr("cx",function(d) { return map.latLngToLayerPoint(d.LatLng).x})
      circle.attr("cy",function(d) { return map.latLngToLayerPoint(d.LatLng).y}).attr("stroke", "black")

      circle.on("mouseover", function(d) {
        circle.on("mouseover", function(d) {   
        _selected_circle=d3.select(this)      
        _selected_circle.original_color=_selected_circle.attr('fill');
        _selected_circle.transition().duration(500).attr('opacity',1)

      })
})

      .on("mouseout", function(d) {
         var _this=d3.select(this)        
        d3.select(this).transition().duration(500).attr('opacity',0.6)
     })

      circle.attr('r',0).transition().duration(500).attr("r", function(d) {
       // console.warn(rScale(d.properties.count))
        return rScale(d.properties.count);
      }).attr('fill',function (d){ 
 
      return ramp(d.properties.count)})
                        .attr('opacity',0.7)
 
    }  //end first_update

     function update() {
      circle.attr("cx",function(d) { return map.latLngToLayerPoint(d.LatLng).x})
      circle.attr("cy",function(d) { return map.latLngToLayerPoint(d.LatLng).y})


    }
    map.on("viewreset", update);
    first_update(cluster_degree);

function  get_text(d)
{                           
 var text='There are <b>'+d.properties.count+'</b> occurrences for taxa '+taxa+' in this cluster';
                                text+='<p><a href="#" class="by_cluster"  degree="'+cluster_degree+'" bbox="'+d.geometry.coordinates+'">Explode around this cluster</a>';
                                // text+='<p><a href="#" class="explode_all" degree="'+cluster_degree+'" bbox="'+d.geometry.coordinates+'">Explode all clusters</a>' 
  return text;
}                                

       $('svg circle').tipsy({ 
                              delayIn: 500, 
                              fade: true, 
                              gravity: 'w', 
                              html: true, 
                              title: function() {
                                var d = this.__data__;
                                //alert(get_text(d))
                                return get_text(d);                               
                              }
                            });
 } //end create_circles


var geojson;

map = new L.Map('map',{ 'crs': L.CRS.EPSG900913})

url='http://a.tiles.mapbox.com/v1/perikut.map-ua7dmxeg.jsonp';

wax.tilejson(url, function(tilejson) {
          basemap = new wax.leaf.connector(tilejson);
         
            map.addLayer(basemap,true)
              })

$('#map').show();

var latlng=new L.LatLng(lat,lng);

//to be changed
var to_plot='scientificname';

map.setView(latlng, 6); 
map.addLayer(new L.Marker(latlng)); 
//we iniciate a SVG layer over which we will append d3.js generated circles (g elements with circles)
map._initPathRoot() 
//select the SVG we just have created and append a g element
  var svg = d3.select("#map").select("svg"),
  g = svg.append("g");

function create_simple_clusters (params)
{
var bounds=params.bounds;

var ajax_params={'taxa':params.taxa,type:to_plot,'zoom':params.zoom,dataset:dataset,
    'requested_action':'get_clusters'}
if( typeof params.bounds != "undefined" ) 
  jQuery.extend(ajax_params,{'literal_bounds':params.literal_bounds})

  jQuery.ajax({url:'http://lully.snv.jussieu.fr/gbif/mapping/php/geojson.php',
  data: ajax_params,
  type: 'GET',
 dataType: 'jsonp',
 crossDomain: 'true',
 success: function (data)
 {
if (params.explode_type=='by_view')
{
jQuery.extend(ajax_params,{'bounds':bounds})
}
//$("#ajax_image").hide()
create_circles.call(this,data,ajax_params);
 },
 error:function ()
 {
 alert('some error')
 }
 })  //end second ajax
} //end create_simple_clusters
   	
function query_bounds()
{  
 return jQuery.ajax({
  url:'http://lully.snv.jussieu.fr/gbif/mapping/php/get_extents_by_taxa.php',
 // data: {'taxa':taxa,type:to_plot,collection:collection},
  data: {'taxa':taxa,'type':'scientificname','dataset':dataset},
  type: 'GET',
  dataType: 'jsonp',
  crossDomain : true,
 success: function(data)
 { 
if (data.main_bbox[0].length= 0) 
  {
   alert('some error in bbox??')
   zoom=2;
    map.fitWorld()
  }
  else
  {  
var bottom_left=data.main_bbox[0].split(',')
var up_right=data.main_bbox[1].split(',')
 bounds = new L.LatLngBounds(
        new L.LatLng(bottom_left[1],bottom_left[0]),
        new L.LatLng(up_right[1],up_right[0]));

zoom=map.getBoundsZoom(bounds)

    var params={'zoom':zoom,'taxa':taxa}

    create_simple_clusters(params);

map.fitBounds(bounds)
  }
 }
})
}  //end query_bounds function

$('#polygon_genus').click(function()
{
geom_type='polygon';
remove_json();
if (d3.selectAll("circle")[0].length>0) d3.selectAll("circle").remove();

//ALL THIS COULD ALSO HAPPENS USING D3.js
polygon_geojson=new L.GeoJSON(null);

polygon_geojson.my_geojson=true;
//my PHP folder!
jQuery.ajax({url:'http://lully.snv.jussieu.fr/gbif/mapping/php/geojson_portal.php',
  data: {taxa:genus,type:'genus',collection:dataset,geom_type:'polygon'},
  type: 'GET',
  dataType: "jsonp", 
    crossDomain : true,
  
 success: function(data)
 {

  polygon_geojson.on('featureparse', function(e) {    
  apply_parsing(e)
  })   
 geojson_max=data.max;
 geojson_min=data.min;

 geojson_medium=data.medium;
 interval_1=data.interval_1;
 interval_2=data.interval_2; 	
 polygon_geojson.addGeoJSON(data);
 
 map.addLayer(polygon_geojson)
 },
 error:function (e)
 {

 alert('error')
 }
 })

})

$('#geo_genus').click(function()
{

  remove_json();

  $.when(query_bounds())
  .then(function(data){

    // $("#ajax_image")
    // .ajaxStart(function(){
    //   //console.warn($(this))
    //   $(this).show();
    // })
    // .ajaxComplete(function(){
    //   $(this).hide();
    // });
    var bottom_left=data.main_bbox[0].split(',')
    var up_right=data.main_bbox[1].split(',')

    bounds = new L.LatLngBounds(
        new L.LatLng(bottom_left[1],bottom_left[0]),

        new L.LatLng(up_right[1],up_right[0]));

    zoom=map.getBoundsZoom(bounds)

    map.fitBounds(bounds) 
  })

});
 

}
 
  
});
</script>
<div class="container">
  <div class="well">
  #{if taxa}
    <ul class="breadcrumb">
      #{if taxa.kingdomID}
      <li><i><a href="@{Taxas.show(taxa.kingdomID)}">${taxa.canonicalKingdom}</a></i><span class="divider">/</span></li>#{/if}
      <li><i><a href="@{Taxas.show(taxa.phylumID)}">${taxa.canonicalPhylum}</a></i><span class="divider">/</span></li>
      <li><i><a href="@{Taxas.show(taxa.classID)}">${taxa.canonicalClass}</a></i><span class="divider">/</span></li>
      <li><i><a href="@{Taxas.show(taxa.orderID)}">${taxa.canonicalOrder}</a></i><span class="divider">/</span></li>
      <li><i><a href="@{Taxas.show(taxa.familyID)}">${taxa.canonicalFamily}</a></i><span class="divider">/</span></li>
      <li><i><a href="@{Taxas.show(taxa.genusID)}">${taxa.canonicalGenus}</a></i><span class="divider">/</span></li>
      #{if taxa.species}
        <li><i><a href="@{Taxas.show(taxa.speciesID)}">${taxa.canonicalSpecies}</a></i></li>
      #{/if}
    </ul>
    <div style="overflow: hidden;">  
      #{if occurrence.associatedMedia}<img style="float:right;" width="200" height="150" src="${occurrence.associatedMedia}"/>#{/if}
      <div  class="page-header">
        <h1>${occurrence.scientificName}</h1>
        #{if taxa.canonicalSpecies}
          <h3>interpreted as <i>${taxa.species}</i></h3>
        #{/if}
        #{elseif taxa.canonicalGenus}
          <h3>interpreted as <i>${taxa.genus}</i></h3>
        #{/elseif}
      </div>
      <h4>${occurrence.dataset.title} - ${occurrence.dataset.dataPublisher.name}</h4>
    </div>
  #{/if}
  #{else}
    <h6>
      No references
    </h6>
    <h1>${occurrence.scientificName}</h1>
    <h4>${occurrence.dataset.title}</h4>
  #{/else}
  </div> 
  #{if occurrence.decimalLatitude && occurrence.decimalLongitude}
    <div id='map' style='display:none;width:70%px;height:300px'></div> 
      <!-- to extend to all taxa levels, this is just for testing -->
    <div style="margin:10px;">
      <button id='geo_genus'>All occurrences for Specie</button>
      <button id='polygon_genus'>All polygon for Specie</button>
    </div>  
  #{/if}
  #{if occurrence.occurrenceID || 
	   occurrence.catalogNumber || 
	   occurrence.occurrenceRemarks || 
	   occurrence.recordNumber || 
	   occurrence.recordedBy || 
	   occurrence.individualID || 
	   occurrence.individualCount || 
	   occurrence.sex || 
	   occurrence.lifeStage || 
	   occurrence.reproductiveCondition || 
	   occurrence.behavior || 
	   occurrence.establishmentMeans || 
	   occurrence.occurrenceStatus || 
	   occurrence.preparations || 
	   occurrence.disposition || 
	   occurrence.otherCatalogNumbers || 
	   occurrence.previousIdentifications || 
	   occurrence.associatedMedia || 
	   occurrence.associatedReferences || 
	   occurrence.associatedOccurrences || 
	   occurrence.associatedSequences || 
	   occurrence.associatedTaxa
  }
  <div class="occurrence-info">
    <h3>Occurrence</h3>
    <table class="table table-condensed table-striped">
      <tbody>
      #{if occurrence.occurrenceID}<tr><th>Occurrence ID</th><td>${occurrence.occurrenceID}</td></tr>#{/if}
      #{if occurrence.catalogNumber}<tr><th>Catalog number</th><td>${occurrence.catalogNumber}</td></tr>#{/if}
      #{if occurrence.occurrenceRemarks}<tr><th>occurrenceRemarks</th><td>${occurrence.occurrenceRemarks}</td></tr>#{/if}
      #{if occurrence.recordNumber}<tr><th>recordNumber</th><td>${occurrence.recordNumber}</td></tr>#{/if}
      #{if occurrence.recordedBy}<tr><th>recordedBy</th><td>${occurrence.recordedBy}</td></tr>#{/if}
	  #{if occurrence.individualID}<tr><th>individualID</th><td>${occurrence.individualID}</td></tr>#{/if}
	  #{if occurrence.individualCount}<tr><th>individualCount</th><td>${occurrence.individualCount}</td></tr>#{/if}
	  #{if occurrence.sex}<tr><th>sex</th><td>${occurrence.sex}</td></tr>#{/if}
	  #{if occurrence.lifeStage}<tr><th>lifeStage</th><td>${occurrence.lifeStage}</td></tr>#{/if}
	  #{if occurrence.reproductiveCondition}<tr><th>reproductiveCondition</th><td>${occurrence.reproductiveCondition}</td></tr>#{/if}
	  #{if occurrence.behavior}<tr><th>behavior</th><td>${occurrence.behavior}</td></tr>#{/if}
	  #{if occurrence.establishmentMeans}<tr><th>establishmentMeans</th><td>${occurrence.establishmentMeans}</td></tr>#{/if}
	  #{if occurrence.occurrenceStatus}<tr><th>occurrenceStatus</th><td>${occurrence.occurrenceStatus}</td></tr>#{/if}
	  #{if occurrence.preparations}<tr><th>preparations</th><td>${occurrence.preparations}</td></tr>#{/if}
	  #{if occurrence.disposition}<tr><th>disposition</th><td>${occurrence.disposition}</td></tr>#{/if}
	  #{if occurrence.otherCatalogNumbers}<tr><th>otherCatalogNumbers</th><td>${occurrence.otherCatalogNumbers}</td></tr>#{/if}
	  #{if occurrence.previousIdentifications}<tr><th>previousIdentifications</th><td>${occurrence.previousIdentifications}</td></tr>#{/if}
	  #{if occurrence.associatedMedia}<tr><th>associatedMedia</th><td>${occurrence.associatedMedia}</td></tr>#{/if}
	  #{if occurrence.associatedReferences}<tr><th>associatedReferences</th><td>${occurrence.associatedReferences}</td></tr>#{/if}
	  #{if occurrence.associatedOccurrences}<tr><th>associatedOccurrences</th><td>${occurrence.associatedOccurrences}</td></tr>#{/if}
	  #{if occurrence.associatedSequences}<tr><th>associatedSequences</th><td>${occurrence.associatedSequences}</td></tr>#{/if}
	  #{if occurrence.associatedTaxa}<tr><th>associatedTaxa</th><td>${occurrence.associatedTaxa}</td></tr>#{/if}	  
	  </tbody>
	</table>
  </div>
  #{/if}
  #{if occurrence.typee || 
	   occurrence.modified || 
	   occurrence.language || 
	   occurrence.rights || 
	   occurrence.rightsHolder || 
	   occurrence.accessRights || 
	   occurrence.bibliographicCitation || 
	   occurrence.referencess || 
	   occurrence.institutionID || 
	   occurrence.collectionID || 
	   occurrence.datasetID || 
	   occurrence.institutionCode || 
	   occurrence.collectionCode || 
	   occurrence.datasetName || 
	   occurrence.ownerInstitutionCode || 
	   occurrence.basisOfRecord || 
	   occurrence.informationWithheld || 
	   occurrence.dataGeneralizations || 
	   occurrence.dynamicProperties
  }
  <div class="record-info">
    <h3>Record</h3>
    <table class="table table-condensed table-striped">
      <tbody>
      #{if occurrence.typee}<tr><th>Type </th><td> ${occurrence.basisOfRecord}</td></tr>#{/if}
      #{if occurrence.modified}<tr><th>Modified </th><td> <b>${occurrence.modified}</b></td></tr>#{/if}
      #{if occurrence.language}<tr><th>Language </th><td> ${occurrence.language}</td></tr>#{/if}
      #{if occurrence.rights}<tr><th>Rights </th><td> ${occurrence.rights}</td></tr>#{/if}
	  #{if occurrence.rightsHolder}<tr><th>Rights Holder </th><td> ${occurrence.rightsHolder}</td></tr>#{/if}
	  #{if occurrence.accessRights}<tr><th>Access Rights </th><td> ${occurrence.accessRights}</td></tr>#{/if}
	  #{if occurrence.bibliographicCitation}<tr><th>Bibliographic Citation </th><td> ${occurrence.bibliographicCitation}</td></tr>#{/if}
	  #{if occurrence.referencess}<tr><th>References </th><td> ${occurrence.referencess}</td></tr>#{/if}
	  #{if occurrence.institutionID}<tr><th>Institution ID  </th><td> ${occurrence.institutionID}</td></tr>#{/if}
	  #{if occurrence.collectionID}<tr><th>Collection ID  </th><td> ${occurrence.collectionID}</td></tr>#{/if}
	  #{if occurrence.datasetID}<tr><th>Dataset ID  </th><td> ${occurrence.datasetID}</td></tr>#{/if}
	  #{if occurrence.institutionCode}<tr><th>Institution Code  </th><td> ${occurrence.institutionCode}</td></tr>#{/if}
	  #{if occurrence.collectionCode}<tr><th>Collection Code </th><td> ${occurrence.collectionCode}</td></tr>#{/if}
	  #{if occurrence.datasetName}<tr><th>Dataset Name  </th><td> ${occurrence.datasetName}</td></tr>#{/if}
	  #{if occurrence.ownerInstitutionCode}<tr><th>Owner Institution Code  </th><td> ${occurrence.ownerInstitutionCode}</td></tr>#{/if}
	  #{if occurrence.informationWithheld}<tr><th>Information With Held  </th><td> ${occurrence.informationWithheld}</td></tr>#{/if}
	  #{if occurrence.dataGeneralizations}<tr><th>Data Generalizations  </th><td> ${occurrence.dataGeneralizations}</td></tr>#{/if}
	  #{if occurrence.dynamicProperties}<tr><th>Dynamic Properties  </th><td> ${occurrence.dynamicProperties}</td></tr>#{/if}
      </tbody>
    </table>  
  </div>
  #{/if}
  #{if occurrence.	taxonID		 || 
	   occurrence.scientificNameID || 
	   occurrence.acceptedNameUsageID || 
	   occurrence.parentNameUsageID || 
	   occurrence.originalNameUsageID || 
	   occurrence.nameAccordingToID || 
	   occurrence.namePublishedInID || 
	   occurrence.taxonConceptID || 
	   occurrence.scientificName || 
	   occurrence.acceptedNameUsage || 
	   occurrence.parentNameUsage || 
	   occurrence.originalNameUsage || 
	   occurrence.nameAccordingTo || 
	   occurrence.namePublishedIn || 
	   occurrence.namePublishedInYear || 
	   occurrence.higherClassification || 
	   occurrence.kingdom || 
	   occurrence.phylum || 
	   occurrence.classs || 
	   occurrence.orderr || 
	   occurrence.family || 
	   occurrence.genus || 
	   occurrence.subgenus || 
	   occurrence.specificEpithet || 
	   occurrence.infraSpecificEpithet || 
	   occurrence.taxonRank || 
	   occurrence.verbatimTaxonRank || 
	   occurrence.scientificNameAuthorship || 
	   occurrence.vernacularName || 
	   occurrence.nomenclaturalCode || 
	   occurrence.taxonomicStatus || 
	   occurrence.nomenclaturalStatus || 
	   occurrence.taxonRemarks || 
	   occurrence.taxonStatus  ||
	   occurrence.ecatConceptId ||
	   occurrence.ecatParentId 
  }
  <div class="taxon-info">
    <h3>Taxon</h3>
    <table class="table table-condensed table-striped">
      <tbody>
    #{if occurrence.taxonID}<tr><th>taxonID </th><td> ${occurrence.taxonID}</td></tr>#{/if}
    #{if occurrence.scientificNameID}<tr><th>scientificNameID </th><td> ${occurrence.scientificNameID}</td></tr>#{/if}
    #{if occurrence.acceptedNameUsageID}<tr><th>acceptedNameUsageID </th><td> ${occurrence.acceptedNameUsageID}</td></tr>#{/if}
    #{if occurrence.parentNameUsageID}<tr><th>parentNameUsageID </th><td> ${occurrence.parentNameUsageID}</td></tr>#{/if}
    #{if occurrence.originalNameUsageID}<tr><th>originalNameUsageID </th><td> ${occurrence.originalNameUsageID}</td></tr>#{/if}
    #{if occurrence.nameAccordingToID}<tr><th>nameAccordingToID </th><td> ${occurrence.nameAccordingToID}</td></tr>#{/if}
    #{if occurrence.namePublishedInID}<tr><th>namePublishedInID </th><td> ${occurrence.namePublishedInID}</td></tr>#{/if}
    #{if occurrence.taxonConceptID}<tr><th>taxonConceptID </th><td> ${occurrence.taxonConceptID}</td></tr>#{/if}
    #{if occurrence.scientificName}<tr><th>scientificName </th><td> ${occurrence.scientificName}</td></tr>#{/if}
    #{if occurrence.acceptedNameUsage}<tr><th>acceptedNameUsage </th><td> ${occurrence.acceptedNameUsage}</td></tr>#{/if}
    #{if occurrence.parentNameUsage}<tr><th>parentNameUsage </th><td> ${occurrence.parentNameUsage}</td></tr>#{/if}
    #{if occurrence.originalNameUsage}<tr><th>originalNameUsage </th><td> ${occurrence.originalNameUsage}</td></tr>#{/if}
    #{if occurrence.nameAccordingTo}<tr><th>nameAccordingTo </th><td> ${occurrence.nameAccordingTo}</td></tr>#{/if}
    #{if occurrence.namePublishedIn}<tr><th>namePublishedIn </th><td> ${occurrence.namePublishedIn}</td></tr>#{/if}
    #{if occurrence.namePublishedInYear}<tr><th>namePublishedInYear </th><td> ${occurrence.namePubfhedInYear}</td></tr>#{/if}
    #{if occurrence.higherClassification}<tr><th>higherClassification </th><td> ${occurrence.higherClassification}</td></tr>#{/if}
    #{if occurrence.kingdom}<tr><th>kingdom </th><td> ${occurrence.kingdom}</td></tr>#{/if}
    #{if occurrence.phylum}<tr><th>phylum </th><td> ${occurrence.phylum}</td></tr>#{/if}
    #{if occurrence.classs}<tr><th>class </th><td> ${occurrence.classs}</td></tr>#{/if}
    #{if occurrence.orderr}<tr><th>order </th><td> ${occurrence.orderr}</td></tr>#{/if}
    #{if occurrence.family}<tr><th>family </th><td> ${occurrence.family}</td></tr>#{/if}
    #{if occurrence.genus}<tr><th>genus </th><td> ${occurrence.genus}</td></tr>#{/if}
    #{if occurrence.subgenus}<tr><th>subgenus </th><td> ${occurrence.subgenus}</td></tr>#{/if}
    #{if occurrence.specificEpithet}<tr><th>specificEpithet </th><td> ${occurrence.specificEpithet}</td></tr>#{/if}
    #{if occurrence.infraSpecificEpithet}<tr><th>infraSpecificEpithet </th><td> ${occurrence.infraSpecificEpithet}</td></tr>#{/if}
    #{if occurrence.taxonRank}<tr><th>taxonRank </th><td> ${occurrence.taxonRank}</td></tr>#{/if}
    #{if occurrence.verbatimTaxonRank}<tr><th>verbatimTaxonRank </th><td> ${occurrence.verbatimTaxonRank}</td></tr>#{/if}
    #{if occurrence.scientificNameAuthorship}<tr><th>scientificNameAuthorship </th><td> ${occurrence.scientificNameAuthorship}</td></tr>#{/if}
    #{if occurrence.vernacularName}<tr><th>vernacularName </th><td> ${occurrence.vernacularName}</td></tr>#{/if}
    #{if occurrence.nomenclaturalCode}<tr><th>nomenclaturalCode </th><td> ${occurrence.nomenclaturalCode}</td></tr>#{/if}
    #{if occurrence.taxonomicStatus}<tr><th>taxonomicStatus </th><td> ${occurrence.taxonomicStatus}</td></tr>#{/if}
    #{if occurrence.nomenclaturalStatus}<tr><th>nomenclaturalStatus </th><td> ${occurrence.nomenclaturalStatus}</td></tr>#{/if}
    #{if occurrence.taxonRemarks}<tr><th>taxonRemarks </th><td> ${occurrence.taxonRemarks}</td></tr>#{/if}
    #{if occurrence.taxonStatus}<tr><th>taxonStatus </th><td> ${occurrence.taxonStatus}</td></tr>#{/if}  
    #{if occurrence.ecatConceptId}<tr><th>ecatConceptId </th><td> ${occurrence.ecatConceptId}</td></tr>#{/if}  
    #{if occurrence.ecatParentId}<tr><th>ecatParentId </th><td> ${occurrence.ecatParentId}</td></tr>#{/if}  
      
    </tbody>
    </table>  
  </div>
  #{/if}
  #{if occurrence.identificationID || 
	   occurrence.identifiedBy || 
	   occurrence.dateIdentified || 
	   occurrence.identificationVerificationStatus || 
	   occurrence.identificationRemarks || 
	   occurrence.identificationQualifier
  }
  <div class="identification-info">
    <h3>Identification</h3>
    <table class="table table-condensed table-striped">
      <tbody>
    #{if occurrence.identificationID}<tr><th>identificationID </th><td> ${occurrence.identificationID}</td></tr>#{/if}
    #{if occurrence.identifiedBy}<tr><th>identifiedBy </th><td> ${occurrence.identifiedBy}</td></tr>#{/if}
    #{if occurrence.dateIdentified}<tr><th>dateIdentified </th><td> ${occurrence.dateIdentified}</td></tr>#{/if}
    #{if occurrence.identificationVerificationStatus}<tr><th>identificationVerificationStatus </th><td> ${occurrence.identificationVerificationStatus}</td></tr>#{/if}
    #{if occurrence.identificationRemarks}<tr><th>identificationRemarks </th><td> ${occurrence.identificationRemarks}</td></tr>#{/if}
    #{if occurrence.identificationQualifier}<tr><th>identificationQualifier </th><td> ${occurrence.identificationQualifier}</td></tr>#{/if}
    </tbody>
    </table>  
  </div>
  #{/if}
  #{if occurrence.eventID || 
	   occurrence.samplingProtocol || 
	   occurrence.samplingEffort || 
	   occurrence.eventDate || 
	   occurrence.eventTime || 
	   occurrence.startDayOfYear || 
	   occurrence.endDayofYear || 
	   occurrence.year || 
	   occurrence.month || 
	   occurrence.day || 
	   occurrence.verbatimEventDate || 
	   occurrence.habitat || 
	   occurrence.fieldNumber || 
	   occurrence.fieldNotes || 
	   occurrence.eventRemarks || 
	   occurrence.typeStatus  
  }
  <div class="event-info">
    <h3>Event</h3>
    <table class="table table-condensed table-striped">
      <tbody>
      #{if occurrence.eventID}<tr><th>Event ID</th><td> ${occurrence.eventID}</td></tr>#{/if}
      #{if occurrence.samplingProtocol}<tr><th>Sampling protocol </th><td> ${occurrence.samplingProtocol}</td></tr>#{/if}
      #{if occurrence.samplingEffort}<tr><th>Sampling effort </th><td> ${occurrence.samplingEffort}</td></tr>#{/if}
      #{if occurrence.eventDate}<tr><th>Event date </th><td> ${occurrence.eventDate}</td></tr>#{/if}
      #{if occurrence.eventTime}<tr><th>Event time </th><td> ${occurrence.eventTime}</td></tr>#{/if}
      #{if occurrence.startDayOfYear}<tr><th>Start day of year </th><td> ${occurrence.startDayOfYear}</td></tr>#{/if}
      #{if occurrence.endDayofYear}<tr><th>End day of year </th><td> ${occurrence.endDayofYear}</td></tr>#{/if}
      #{if occurrence.year}<tr><th>Year </th><td> ${occurrence.year}</td></tr>#{/if}
      #{if occurrence.month}<tr><th>Month </th><td> ${occurrence.month}</td></tr>#{/if}
      #{if occurrence.day}<tr><th>Day </th><td> ${occurrence.day}</td></tr>#{/if}
      #{if occurrence.verbatimEventDate}<tr><th>Verbatim event date </th><td> ${occurrence.verbatimEventDate}</td></tr>#{/if}
      #{if occurrence.habitat}<tr><th>Habitat </th><td> ${occurrence.habitat}</td></tr>#{/if}
      #{if occurrence.fieldNumber}<tr><th>Field number </th><td> ${occurrence.fieldNumber}</td></tr>#{/if}
      #{if occurrence.fieldNotes}<tr><th>Fields notes </th><td> ${occurrence.fieldNotes}</td></tr>#{/if}
      #{if occurrence.eventRemarks}<tr><th>Event remarks </th><td> ${occurrence.eventRemarks}</td></tr>#{/if}
      #{if occurrence.typeStatus}<tr><th>typeStatus </th><td> ${occurrence.typeStatus}</td></tr>#{/if}
    </tbody>
    </table>  
  </div>
  #{/if}
  #{if occurrence.locationID || 
	   occurrence.higherGeographyID || 
	   occurrence.higherGeography || 
	   occurrence.continent || 
	   occurrence.waterBody || 
	   occurrence.islandGroup || 
	   occurrence.island || 
	   occurrence.country || 
	   occurrence.countryCode || 
	   occurrence.stateProvince || 
	   occurrence.county || 
	   occurrence.municipality || 
	   occurrence.locality || 
	   occurrence.verbatimLocality || 
	   occurrence.verbatimElevation || 
	   occurrence.minimumElevationInMeters || 
	   occurrence.maximumElevationInMeters || 
	   occurrence.verbatimDepth || 
	   occurrence.minimumDepthInMeters || 
	   occurrence.maximumDepthInMeters || 
	   occurrence.minimumDistanceAboveSurfaceInMeters || 
	   occurrence.maximumDistanceAboveSurfaceInMeters || 
	   occurrence.locationAccordingTo || 
	   occurrence.locationRemarks || 
	   occurrence.verbatimCoordinates || 
	   occurrence.verbatimLatitude || 
	   occurrence.verbatimLongitude || 
	   occurrence.verbatimCoordinateSystem || 
	   occurrence.verbatimSRS || 
	   occurrence.decimalLatitude || 
	   occurrence.decimalLongitude || 
	   occurrence.geodeticDatum || 
	   occurrence.coordinateUncertaintyInMeters || 
	   occurrence.coordinatePrecision || 
	   occurrence.pointRadiusSpatialFit || 
	   occurrence.footprintWKT || 
	   occurrence.footprintSRS || 
	   occurrence.footprintSpatialFit || 
	   occurrence.georeferencedBy || 
	   occurrence.georeferencedDate || 
	   occurrence.georeferenceProtocol || 
	   occurrence.georeferenceSources || 
	   occurrence.georeferenceVerificationStatus || 
	   occurrence.georeferenceRemarks
  }
  <div class="location-info">
    <h3>Location</h3>
    <table class="table table-condensed table-striped">
      <tbody>
    #{if occurrence.locationID}<tr><th>locationID </th><td> ${occurrence.locationID}</td></tr>#{/if}
    #{if occurrence.higherGeographyID}<tr><th>higherGeographyID </th><td> ${occurrence.higherGeographyID}</td></tr>#{/if}
    #{if occurrence.higherGeography}<tr><th>higherGeography </th><td> ${occurrence.higherGeography}</td></tr>#{/if}
    #{if occurrence.continent}<tr><th>continent </th><td> ${occurrence.continent}</td></tr>#{/if}
    #{if occurrence.waterBody}<tr><th>waterBody </th><td> ${occurrence.waterBody}</td></tr>#{/if}
    #{if occurrence.islandGroup}<tr><th>islandGroup </th><td> ${occurrence.islandGroup}</td></tr>#{/if}
    #{if occurrence.island}<tr><th>island </th><td> ${occurrence.island}</td></tr>#{/if}
    #{if occurrence.country}<tr><th>country </th><td> ${occurrence.country}</td></tr>#{/if}
    #{if occurrence.countryCode}<tr><th>countryCode </th><td> ${occurrence.countryCode}</td></tr>#{/if}
    #{if occurrence.stateProvince}<tr><th>stateProvince </th><td> ${occurrence.stateProvince}</td></tr>#{/if}
    #{if occurrence.county}<tr><th>county </th><td> ${occurrence.county}</td></tr>#{/if}
    #{if occurrence.municipality}<tr><th>municipality </th><td> ${occurrence.municipality}</td></tr>#{/if}
    #{if occurrence.locality}<tr><th>locality </th><td> ${occurrence.locality}</td></tr>#{/if}
    #{if occurrence.verbatimLocality}<tr><th>verbatimLocality </th><td> ${occurrence.verbatimLocality}</td></tr>#{/if}
    #{if occurrence.verbatimElevation}<tr><th>verbatimElevation </th><td> ${occurrence.verbatimElevation}</td></tr>#{/if}
    #{if occurrence.minimumElevationInMeters}<tr><th>minimumElevationInMeters </th><td> ${occurrence.minimumElevationInMeters}</td></tr>#{/if}
    #{if occurrence.maximumElevationInMeters}<tr><th>maximumElevationInMeters </th><td> ${occurrence.maximumElevationInMeters}</td></tr>#{/if}
    #{if occurrence.verbatimDepth}<tr><th>verbatimDepth </th><td> ${occurrence.verbatimDepth}</td></tr>#{/if}
    #{if occurrence.minimumDepthInMeters}<tr><th>minimumDepthInMeters </th><td> ${occurrence.minimumDepthInMeters}</td></tr>#{/if}
    #{if occurrence.maximumDepthInMeters}<tr><th>maximumDepthInMeters </th><td> ${occurrence.maximumDepthInMeters}</td></tr>#{/if}
    #{if occurrence.minimumDistanceAboveSurfaceInMeters}<tr><th>minimumDistanceAboveSurfaceInMeters </th><td> ${occurrence.minimumDistanceAboveSurfaceInMeters}</td></tr>#{/if}
    #{if occurrence.maximumDistanceAboveSurfaceInMeters}<tr><th>maximumDistanceAboveSurfaceInMeters </th><td> ${occurrence.maximumDistanceAboveSurfaceInMeters}</td></tr>#{/if}
    #{if occurrence.locationAccordingTo}<tr><th>locationAccordingTo </th><td> ${occurrence.locationAccordingTo}</td></tr>#{/if}
    #{if occurrence.locationRemarks}<tr><th>locationRemarks </th><td> ${occurrence.locationRemarks}</td></tr>#{/if}
    #{if occurrence.verbatimCoordinates}<tr><th>verbatimCoordinates </th><td> ${occurrence.verbatimCoordinates}</td></tr>#{/if}
    #{if occurrence.verbatimLatitude}<tr><th>verbatimLatitude </th><td> ${occurrence.verbatimLatitude}</td></tr>#{/if}
    #{if occurrence.verbatimLongitude}<tr><th>verbatimLongitude </th><td> ${occurrence.verbatimLongitude}</td></tr>#{/if}
    #{if occurrence.verbatimCoordinateSystem}<tr><th>verbatimCoordinateSystem </th><td> ${occurrence.verbatimCoordinateSystem}</td></tr>#{/if}
    #{if occurrence.verbatimSRS}<tr><th>verbatimSRS </th><td> ${occurrence.verbatimSRS}</td></tr>#{/if}
    #{if occurrence.decimalLatitude}<tr><th>decimalLatitude </th><td> ${occurrence.decimalLatitude}</td></tr>#{/if}
    #{if occurrence.decimalLongitude}<tr><th>decimalLongitude </th><td> ${occurrence.decimalLongitude}</td></tr>#{/if}
    #{if occurrence.geodeticDatum}<tr><th>geodeticDatum </th><td> ${occurrence.geodeticDatum}</td></tr>#{/if}
    #{if occurrence.coordinateUncertaintyInMeters}<tr><th>coordinateUncertaintyInMeters </th><td> ${occurrence.coordinateUncertaintyInMeters}</td></tr>#{/if}
    #{if occurrence.coordinatePrecision}<tr><th>coordinatePrecision </th><td> ${occurrence.coordinatePrecision}</td></tr>#{/if}
    #{if occurrence.pointRadiusSpatialFit}<tr><th>pointRadiusSpatialFit </th><td> ${occurrence.pointRadiusSpatialFit}</td></tr>#{/if}
    #{if occurrence.footprintWKT}<tr><th>footprintWKT </th><td> ${occurrence.footprintWKT}</td></tr>#{/if}
    #{if occurrence.footprintSRS}<tr><th>footprintSRS </th><td> ${occurrence.footprintSRS}</td></tr>#{/if}
    #{if occurrence.footprintSpatialFit}<tr><th>footprintSpatialFit </th><td> ${occurrence.footprintSpatialFit}</td></tr>#{/if}
    #{if occurrence.georeferencedBy}<tr><th>georeferencedBy </th><td> ${occurrence.georeferencedBy}</td></tr>#{/if}
    #{if occurrence.georeferencedDate}<tr><th>georeferencedDate </th><td> ${occurrence.georeferencedDate}</td></tr>#{/if}
    #{if occurrence.georeferenceProtocol}<tr><th>georeferenceProtocol </th><td> ${occurrence.georeferenceProtocol}</td></tr>#{/if}
    #{if occurrence.georeferenceSources}<tr><th>georeferenceSources </th><td> ${occurrence.georeferenceSources}</td></tr>#{/if}
    #{if occurrence.georeferenceVerificationStatus}<tr><th>georeferenceVerificationStatus </th><td> ${occurrence.georeferenceVerificationStatus}</td></tr>#{/if}
    #{if occurrence.georeferenceRemarks}<tr><th>georeferenceRemarks </th><td> ${occurrence.georeferenceRemarks}</td></tr>#{/if}
    </tbody>
    </table>  
  </div>
  #{/if}
  #{if occurrence.geologicalContextID || 
	   occurrence.earliestEonOrLowestEonothem || 
	   occurrence.latestEonOrHighestEonothem || 
	   occurrence.earliestEraOrLowestErathem || 
	   occurrence.latestEraOrHighestErathem || 
	   occurrence.earliestPeriodOrLowestSystem || 
	   occurrence.latestPeriodOrHighestSystem || 
	   occurrence.earliestEpochOrLowestSeries || 
	   occurrence.latestEpochOrHighestSeries || 
	   occurrence.earliestAgeOrLowestStage || 
	   occurrence.latestAgeOrHighestStage || 
	   occurrence.lowestBiostratigraphicZone || 
	   occurrence.highestBiostratigraphicZone || 
	   occurrence.lithostratigraphicTerms || 
	   occurrence.groupp || 
	   occurrence.formation || 
	   occurrence.member || 
	   occurrence.bed
  }
  <div class="location-info">
    <h3>Geological Context</h3>
    <table class="table table-condensed table-striped">
      <tbody>
    #{if occurrence.geologicalContextID}<tr><th>geologicalContextID </th><td> ${occurrence.geologicalContextID}</td></tr>#{/if}
    #{if occurrence.earliestEonOrLowestEonothem}<tr><th>earliestEonOrLowestEonothem </th><td> ${occurrence.earliestEonOrLowestEonothem}</td></tr>#{/if}
    #{if occurrence.latestEonOrHighestEonothem}<tr><th>latestEonOrHighestEonothem </th><td> ${occurrence.latestEonOrHighestEonothem}</td></tr>#{/if}
    #{if occurrence.earliestEraOrLowestErathem}<tr><th>earliestEraOrLowestErathem </th><td> ${occurrence.earliestEraOrLowestErathem}</td></tr>#{/if}
    #{if occurrence.latestEraOrHighestErathem}<tr><th>latestEraOrHighestErathem </th><td> ${occurrence.latestEraOrHighestErathem}</td></tr>#{/if}
    #{if occurrence.earliestPeriodOrLowestSystem}<tr><th>earliestPeriodOrLowestSystem </th><td> ${occurrence.earliestPeriodOrLowestSystem}</td></tr>#{/if}
    #{if occurrence.latestPeriodOrHighestSystem}<tr><th>latestPeriodOrHighestSystem </th><td> ${occurrence.latestPeriodOrHighestSystem}</td></tr>#{/if}
    #{if occurrence.earliestEpochOrLowestSeries}<tr><th>earliestEpochOrLowestSeries </th><td> ${occurrence.earliestEpochOrLowestSeries}</td></tr>#{/if}
    #{if occurrence.latestEpochOrHighestSeries}<tr><th>latestEpochOrHighestSeries </th><td> ${occurrence.latestEpochOrHighestSeries}</td></tr>#{/if}
    #{if occurrence.earliestAgeOrLowestStage}<tr><th>earliestAgeOrLowestStage </th><td> ${occurrence.earliestAgeOrLowestStage}</td></tr>#{/if}
    #{if occurrence.latestAgeOrHighestStage}<tr><th>latestAgeOrHighestStage </th><td> ${occurrence.latestAgeOrHighestStage}</td></tr>#{/if}
    #{if occurrence.lowestBiostratigraphicZone}<tr><th>lowestBiostratigraphicZone </th><td> ${occurrence.lowestBiostratigraphicZone}</td></tr>#{/if}
    #{if occurrence.highestBiostratigraphicZone}<tr><th>highestBiostratigraphicZone </th><td> ${occurrence.highestBiostratigraphicZone}</td></tr>#{/if}
    #{if occurrence.lithostratigraphicTerms}<tr><th>lithostratigraphicTerms </th><td> ${occurrence.lithostratigraphicTerms}</td></tr>#{/if}
    #{if occurrence.groupp}<tr><th>group </th><td> ${occurrence.groupp}</td></tr>#{/if}
    #{if occurrence.formation}<tr><th>formation </th><td> ${occurrence.formation}</td></tr>#{/if}
    #{if occurrence.member}<tr><th>member </th><td> ${occurrence.member}</td></tr>#{/if}
    #{if occurrence.bed}<tr><th>bed </th><td> ${occurrence.bed}</td></tr>#{/if} 
    </tbody>
    </table>  
  </div>
  #{/if}
</div>