#{extends 'main.html' /}
#{set title:'Home' /}
<script type="text/javascript">
jQuery(document).ready(function($) {
  var interaction;
var lat=48.856930;
var lng=2.341200;
var latlng=new L.LatLng(lat,lng);

// var osmUrl='http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png';
//   var osmAttrib='Map data © OpenStreetMap contributors';
//   var osm = new L.TileLayer(osmUrl);
//   osm.basemap=true;
//   //, {minZoom: 5, maxZoom: 12, attribution: osmAttrib}
  
map = new L.Map('map')
map.addLayer(new L.Marker(latlng)); 

// var osmUrl='http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png';
//   var osmAttrib='Map data © OpenStreetMap contributors';
//   var osm = new L.TileLayer(osmUrl);

 url='http://api.tiles.mapbox.com/v2/worldbank-climate.change-in-ag-yields,worldbank-climate.percent-gdp-added-by-agriculture,worldbank-climate.wbc-borders.jsonp';
// url='http://lully.snv.jussieu.fr/gbif/mapping/basemap/metadata.jsonp';
     wax.tilejson(url, function(tilejson) {
          basemap = new wax.leaf.connector(tilejson);
         map.addLayer(basemap);
         })

 map.setView(latlng, 5);

                          // map.addLayer(osm)
  // Stuff to do as soon as the DOM is ready. Use $() w/o colliding with other libs;
  console.warn('${dataPublisher.id}');
  
   $('.dropdown-toggle').dropdown()

     layers=[{'name':'occurrences','title':'Occurrences',
          'url':' http://lully.snv.jussieu.fr/gbif/mapping/mbtiles/simple_spn_mnhn_2/metadata.jsonp'},
          {
      'name':'cantons','title':'Cantons France',       
      'url':'http://lully.snv.jussieu.fr/gbif/mapping/mbtiles/cantons_spn_mnhn/metadata.jsonp'
          },
            {
      'name':'departements','title':'Departements France',  
      //to change url     
      'url':'http://lully.snv.jussieu.fr/gbif/mapping/mbtiles/cantons_spn_mnhn/metadata.jsonp'
          },
      {
      'name':'arrondissements','title':'Arrondissements France',       
      'url':'http://lully.snv.jussieu.fr/gbif/mapping/mbtiles/france3_2_spn_mnhn/metadata.jsonp'
          },    
      {
      'name':'regions','title':'Regions France', 
      'url':'http://lully.snv.jussieu.fr/gbif/mapping/mbtiles/region_spn_mnhn/metadata.jsonp'
      }]

  $('#polygon_type a,#map_occ a').click(function(event)
{
 $('#map').animate({'height':'500px'})

          event.preventDefault()
          var layer=$(this).parent().attr('id');
 
          $.each(map._layers, function(index, value) { 
      
                    map.removeLayer(value)
                 })  
                 
       
            $.each(layers,function(i,data)
            {
            if(data.name==layer)
            {
                    
                       url=data.url;
                       var layer_name=data.name;
                       if (interaction!==undefined)
                        interaction.remove()
                       
                       wax.tilejson(url, function(tilejson) {              
                             layer_name= new wax.leaf.connector(tilejson);
                             layer_name.name=layer;
                             layer_name.title=data.title;
                             layer_name.type='layer';
                             map.addLayer(layer_name);
                             map.addLayer(basemap);
                             layer_name.setOpacity(0.8)                
                             interaction = wax.leaf.interaction(map, tilejson)                
                           });  
                           
           // $('.my_legend').fadeOut('slow').empty();
         
            }
            
            })  

})
   
 

 

});

</script>
<div class="container">
<div class="container-fluid">
  <div class="row-fluid">
    <div class="page-header well alert-info">
      <h1>${dataPublisher.name}</h1>
    </div>
    <div id="map" style='width:100%;height:300px;position:relative'></div>


   <div class="nav-collapse">
   <ul class="nav">
      <li class="dropdown"><a data-toggle="dropdown" class="dropdown-toggle" href="#">Show biodiversity by polygon<b class="caret"></b></a>
          <ul id='polygon_type' class="dropdown-menu">
            <li id='departements'><a  href="#">Departements</a></li>
            <li id='cantons'><a  href="#">Cantons</a></li>
            <li id='arrondissements'><a  href="#">Arrondissements</a></li>
            <li id='regions'><a  href="#">Regions</a></li>
          </ul>
      </li>
    </ul>

  
  
   </div>


    <ul id='map_occ' style='list-style:none;margin:0 0 0 0'>
    <li id='occurrences'><a href="#">Check biodiversity map by occurrences</a></li>
    </ul>
   <!-- <iframe width="900" height="200" frameborder="0" scrolling="no" marginheight="0" marginwidth="0" src="http://maps.google.fr/maps?f=q&amp;source=s_q&amp;hl=en&amp;geocode=&amp;q=Mus%C3%A9um+national+d'Histoire+naturelle+61+rue+Buffon&amp;aq=&amp;sll=46.75984,1.738281&amp;sspn=9.967265,23.269043&amp;ie=UTF8&amp;hq=Mus%C3%A9um+national+d'Histoire+naturelle+61+rue+Buffon&amp;hnear=&amp;ll=48.841808,2.357741&amp;spn=0.074784,0.181789&amp;t=m&amp;z=10&amp;iwloc=${dataPublisher.name}&amp;cid=2299256314626690090&amp;output=embed"></iframe><br /></small>-->
  
 <!--    <div class="btn btn-small"></div>  -->
 
    <div class="page-header well alert-error">
      <h3>Datasets</h3>
      <div class="btn-group">
      #{list items:datasets, as:'dataset'}
        <div class="btn btn-large"><a href="@{Datasets.show(dataset.id)}">${dataset.name}</a></div>
      #{/list}
      </div>
    </div>
    <table class="table table-condensed table-striped">
      <tbody>
        <tr>
          <th>Description</th>
          <td>${dataPublisher.description}</td>
        </tr>
        <tr>  
          <th>Adresse</th>
          <td>${dataPublisher.address}</td>
        </tr>  
      </tbody>
    </table>
  </div>
  </div>
</div>