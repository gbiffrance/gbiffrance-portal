#{extends 'main.html' /}
      <script src="@{'/public/javascripts/d3.v2.min.js'}"></script>
      <script src="@{'/public/javascripts/nv.d3.min.js'}"></script>
      <script src="@{'/public/javascripts/pieChart.js'}"></script>
      <link rel="stylesheet" media="screen" href="@{'/public/stylesheets/charts.css'}"></link>
#{set title:'Home' /}
<script type="text/javascript">
var data;
jQuery(document).ready(function($) {

var url = window.location.search.split("id=");
var dataset_id=url[1];
//  console.warn(eval(dataset))
  var interaction;
var lat=48.856930;
var lng=2.341200;
var latlng=new L.LatLng(lat,lng);

map = new L.Map('map')
map.addLayer(new L.Marker(latlng)); 


 url='http://a.tiles.mapbox.com/v1/perikut.map-ua7dmxeg.jsonp';
     wax.tilejson(url, function(tilejson) {
          basemap = new wax.leaf.connector(tilejson);
         map.addLayer(basemap,true);
         })

 map.setView(latlng, 5);
  /*
   $('.dropdown-toggle').dropdown()

     layers=[{'name':'occurrences','title':'Occurrences',
          'url':'http://lully.snv.jussieu.fr/gbif/mapping/mbtiles/simple_inpn2_3/metadata.jsonp'},
          {
      'name':'cantons','title':'Cantons France',       
      'url':'http://lully.snv.jussieu.fr/gbif/mapping/mbtiles/cantons_spn_mnhn/metadata.jsonp'
          },
            {
      'name':'departements','title':'Departements France',  
      //to change url     
      'url':'http://lully.snv.jussieu.fr/gbif/mapping/mbtiles/cantons_spn_mnhn/metadata.jsonp'
          },
      {
      'name':'arrondissements','title':'Arrondissements France',       
      'url':'http://lully.snv.jussieu.fr/gbif/mapping/mbtiles/france3_2_spn_mnhn/metadata.jsonp'
          },    
      {
      'name':'regions','title':'Regions France', 
      'url':'http://lully.snv.jussieu.fr/gbif/mapping/mbtiles/region_spn_mnhn/metadata.jsonp'
      }]

  $('#polygon_type a,#map_occ a').click(function(event)
{
 $('#map').animate({'height':'500px'})

          event.preventDefault()
          var layer=$(this).parent().attr('id');
 
          $.each(map._layers, function(index, value) { 
      
                    map.removeLayer(value)
                 })  
                 
       
            $.each(layers,function(i,data)
            {
            if(data.name==layer)
            {
                    
                       url=data.url;
                       var layer_name=data.name;
                       if (interaction!==undefined)
                        interaction.remove()
                       
                       wax.tilejson(url, function(tilejson) {              
                             layer_name= new wax.leaf.connector(tilejson);
                             layer_name.name=layer;
                             layer_name.title=data.title;
                             layer_name.type='layer';
                             map.addLayer(layer_name);
                             map.addLayer(basemap,true);
                             layer_name.setOpacity(0.8)                
                             interaction = wax.leaf.interaction(map, tilejson)                
                           });  
                           
           // $('.my_legend').fadeOut('slow').empty();
         
            }
            
            })  

})
   
  $('#stats_type a').click(function(event)
{

          event.preventDefault()
          
          var taxa_type=$(this).parent().attr('id');
console.warn(taxa_type)

$('#stats_div').show().animate({'height':'500px'});

$.ajax(
    'http://lully.snv.jussieu.fr/gbif/mapping/php/stats_json.php?id='+dataset_id,
    {
    jsonpCallback: 'callback',
    crossDomain:true, 
    dataType: "jsonp",
    
      error:function (xhr, ajaxOptions, thrownError){
                    console.info(xhr.status);
                    console.warn(thrownError);
                }  
    ,
    success : function(data){
      var to_plot=data[0][taxa_type];

      nv.addGraph(function() {
        var width = 500,
        height = 500;

    var chart = nv.models.pieChart()
        .x(function(d) { return d.key })
        //.y(function(d) { return d.value })
        .values(function(d) { return d })
        //.labelThreshold(.08)
        //.showLabels(false)
        .color(d3.scale.category10().range())
        .width(width)
        .height(height)
        .donut(true);

 
          width=700,height=500
          d3.select("#chart")
          .datum([to_plot])
          .transition().duration(1800)
          .attr('width', width)
          .attr('height', height)
          .call(chart);

    return chart;

    })
    
    } //votre callback
});

})

 */

});

</script>
<div class="container">
<div class="container-fluid">
  <div class="row-fluid">
    <div class="page-header well alert-info">
      <h1>${dataPublisher.name}</h1>
    </div>
    <div id="map" style='width:100%;height:300px;position:relative'></div>


<!--    <div class="nav-collapse">
   <ul class="nav">
      <li class="dropdown"><a data-toggle="dropdown" class="dropdown-toggle" href="#">Show biodiversity by polygon<b class="caret"></b></a>
          <ul id='polygon_type' class="dropdown-menu">
            <li id='departements'><a  href="#">Departements</a></li>
            <li id='cantons'><a  href="#">Cantons</a></li>
            <li id='arrondissements'><a  href="#">Arrondissements</a></li>
            <li id='regions'><a  href="#">Regions</a></li>
          </ul>
      </li>
    </ul>

  
  
   </div> -->


<!--     <ul style='list-style:none;margin:0 0 0 0'>
    <li id='occurrences'><a href="#">Check biodiversity map by occurrences</a></li>

    <div class="nav-collapse">
    <div class="nav">
      <li class="dropdown">
        <a data-toggle="dropdown" class="dropdown-toggle" href="#">Check 5 most abundant taxa statistics by<b class="caret"></b></a>
          <ul id='stats_type' class="dropdown-menu">
            <li id='kingdom'><a  href="#">kingdom</a></li>
             <li id='phylum'><a  href="#">phylum</a></li>
             <li id='family'><a  href="#">family</a></li>
             <li id='order'><a  href="#">order</a></li>
             <li id='class'><a  href="#">class</a></li>
             <li id='genus'><a  href="#">genus</a></li>
             <li id='scientificname'><a  href="#">scientificname</a></li>             
          </ul>  
      </li>
    </div>  
    </div>
  
    </ul> -->

  
 <!--    <div class="btn btn-small"></div>  -->
    <div id='stats_div' style='display:hidden;width:500px;height:10px'>
      <svg id='chart'></svg>
    </div>
    <div class="page-header well">

      <h3>Datasets</h3>
      <div class="btn-group">
      #{list items:datasets, as:'dataset'}
        <div class="btn btn-large"><a href="@{Datasets.show(dataset.id)}">${dataset.name}</a></div>
      #{/list}
      </div>
    </div>
    <table class="table table-condensed table-striped">
      <tbody>
        <tr>
          <th>Description</th>
          <td>${dataPublisher.description}</td>
        </tr>
        <tr>  
          <th>Adresse</th>
          <td>${dataPublisher.address}</td>
        </tr>  
      </tbody>
    </table>
  </div>
  </div>
</div>